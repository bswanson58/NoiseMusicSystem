<UserControl x:Class="Noise.UI.Views.AlbumView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:Behaviours="clr-namespace:Noise.UI.Behaviours"
             xmlns:Controls="clr-namespace:Noise.UI.Controls"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             d:DesignHeight="300"
             d:DesignWidth="300"
             mc:Ignorable="d">

    <UserControl.DataContext>
        <Binding Path="AlbumViewModel" Source="{StaticResource ViewModelLocator}" />
    </UserControl.DataContext>

    <GroupBox Margin="0"
              BorderBrush="{DynamicResource TrimColor}"
              BorderThickness="1">
        <GroupBox.Header>
            <StackPanel Orientation="Horizontal">
                <Button Width="23"
                        Height="19"
                        Margin="3,0,0,2"
                        Command="{Binding Path=SwitchView}"
                        Content="{StaticResource Path_SwitchView}" />
                <TextBlock Margin="5,0,3,2"
                           VerticalAlignment="Center"
                           Text="Album" />
            </StackPanel>
        </GroupBox.Header>
        <Grid Behaviours:GridUtils.RowDefinitions="Auto,*" Visibility="{Binding Path=AlbumValid, Converter={StaticResource BooleanVisibilityConverter}}">
            <Border Grid.Row="0"
                    Background="{DynamicResource TreeItemBackground}"
                    BorderThickness="0"
                    CornerRadius="5">
                <Grid Background="{StaticResource NoiseBrush}" Behaviours:GridUtils.ColumnDefinitions="Auto,*,Auto">
                    <!--  Album cover image  -->
                    <Viewbox Grid.Column="0"
                             MaxWidth="300"
                             MaxHeight="200"
                             Margin="7"
                             Stretch="Uniform">
                        <Image RenderTransformOrigin="0.5,0.5">
                            <Image.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform />
                                    <SkewTransform />
                                    <RotateTransform Angle="{Binding Path=AlbumCover.Rotation}" />
                                    <TranslateTransform X="{Binding Path=AlbumCover.ImageLeft}" Y="{Binding Path=AlbumCover.ImageTop}" />
                                </TransformGroup>
                            </Image.RenderTransform>
                            <i:Interaction.Behaviors>
                                <Behaviours:ImageScrubber Image="{Binding Path=AlbumCover, Mode=TwoWay}" ImageList="{Binding Path=AlbumArtwork}" />
                            </i:Interaction.Behaviors>
                        </Image>
                    </Viewbox>
                    <Grid Grid.Column="2"
                          Margin="3,0,25,0"
                          Behaviours:GridUtils.RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,*,Auto">
                        <!--  Album name and Play button  -->
                        <Grid Grid.Row="0"
                              Margin="0,0,0,9"
                              HorizontalAlignment="Right"
                              Behaviours:GridUtils.ColumnDefinitions="Auto,Auto">
                            <Button Grid.Column="0"
                                    Margin="0,0,3,0"
                                    Command="{Binding Path=PlayAlbum}"
                                    Style="{StaticResource PlayButtonStyle}" />
                            <TextBlock Grid.Column="1"
                                       HorizontalAlignment="Right"
                                       VerticalAlignment="Center"
                                       FontSize="20"
                                       Text="{Binding Path=Album.Name}" />
                        </Grid>

                        <!--  Favorite and rating  -->
                        <StackPanel Grid.Row="1"
                                    HorizontalAlignment="Right"
                                    Orientation="Horizontal">
                            <CheckBox Width="15"
                                      Height="15"
                                      Margin="0,0,9,0"
                                      VerticalAlignment="Center"
                                      IsChecked="{Binding Path=Album.UiIsFavorite,
                                                          Mode=TwoWay}"
                                      Style="{StaticResource FavoriteCheckBoxStyle}" />
                            <Controls:RatingControl Rating="{Binding Path=Album.UiRating, Mode=TwoWay}" Style="{StaticResource NoiseRatingStyle}" />
                        </StackPanel>

                        <TextBlock Grid.Row="2"
                                   HorizontalAlignment="Right"
                                   Text="{Binding Path=Album.Genre}" />
                        <TextBlock Grid.Row="3"
                                   HorizontalAlignment="Right"
                                   Text="{Binding Path=Album.PublishedYear,
                                                  Converter={StaticResource PublishedYearConverter}}" />

                        <!--  Playing time  -->
                        <StackPanel Grid.Row="4"
                                    HorizontalAlignment="Right"
                                    Orientation="Horizontal">
                            <TextBlock Text="Playing time: " />
                            <TextBlock Text="{Binding Path=AlbumPlayTime, Converter={StaticResource TimeSpanConverter}}" />
                        </StackPanel>

                        <!--  Categories  -->
                        <StackPanel Grid.Row="5"
                                    HorizontalAlignment="Right"
                                    Orientation="Horizontal">
                            <TextBlock Text="Categories: " />
                            <TextBlock Text="{Binding Path=AlbumCategories}" />
                        </StackPanel>

                        <!--  Album commands  -->
                        <StackPanel Grid.Row="7"
                                    HorizontalAlignment="Right"
                                    Orientation="Horizontal">
                            <Button Width="19"
                                    Height="19"
                                    Margin="0,0,5,5"
                                    Command="{Binding Path=OpenAlbumFolder}"
                                    Content="{StaticResource Path_Folder}"
                                    Foreground="{StaticResource ControlTextColor}"
                                    Padding="1"
                                    ToolTip="Open Album Folder" />
                            <Button Width="19"
                                    Height="19"
                                    Margin="0,0,5,5"
                                    Command="{Binding DisplayPictures}"
                                    Content="{StaticResource Path_Pictures}"
                                    Foreground="{StaticResource ControlTextColor}"
                                    Padding="1"
                                    ToolTip="Display Album Extras" />
                            <Button Width="19"
                                    Height="19"
                                    Margin="0,0,5,5"
                                    Command="{Binding EditCategories}"
                                    Content="{StaticResource Path_Categories}"
                                    Foreground="{StaticResource ControlTextColor}"
                                    Padding="1"
                                    ToolTip="Edit Album Categories" />
                            <Button Width="19"
                                    Height="19"
                                    Margin="0,0,0,5"
                                    Command="{Binding Path=EditAlbum}"
                                    Content="{StaticResource Path_Edit}"
                                    Foreground="{StaticResource ControlTextColor}"
                                    Padding="2"
                                    ToolTip="Edit Album Properties" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>
            <GroupBox Grid.Row="1"
                      Margin="0,0,3,0"
                      BorderBrush="{DynamicResource TrimColor}"
                      BorderThickness="1"
                      Header=" Tracks ">
                <ListView Behaviours:GridViewSort.AutoSort="True"
                          Behaviours:ListViewColumns.Stretch="true"
                          Behaviours:ListViewFirstItemVisible.ChangeTrigger="{Binding Path=Album,
                                                                                      Mode=OneWay}"
                          BorderThickness="0"
                          ItemsSource="{Binding Path=TrackList}">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="{x:Type ListViewItem}">
                            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Width="27" HeaderTemplate="{StaticResource PlayColumnHeaderTemplate}">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Command="{Binding Path=Play}" Style="{StaticResource PlayButtonStyle}" />
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Width="33"
                                            Behaviours:GridViewSort.PropertyName="TrackNumber"
                                            Header="#">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Path=TrackNumber}" TextAlignment="Right" />
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Behaviours:GridViewSort.PropertyName="Name"
                                            DisplayMemberBinding="{Binding Path=Name}"
                                            Header="Track Name" />
                            <GridViewColumn Width="75"
                                            Behaviours:GridViewSort.PropertyName="Duration"
                                            Header="Duration">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Path=Duration, Converter={StaticResource TimeSpanConverter}}" TextAlignment="Right" />
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Width="27"
                                            Behaviours:GridViewSort.PropertyName="UiIsFavorite"
                                            HeaderTemplate="{StaticResource FavoriteColumnHeaderTemplate}">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox HorizontalAlignment="Center"
                                                  IsChecked="{Binding Path=UiIsFavorite,
                                                                      Mode=TwoWay}"
                                                  Style="{StaticResource FavoriteCheckBoxStyle}" />
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Width="115"
                                            Behaviours:GridViewSort.PropertyName="UiRating"
                                            Header="Rating">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Controls:RatingControl HorizontalAlignment="Center"
                                                                Rating="{Binding Path=UiRating,
                                                                                 Mode=TwoWay}"
                                                                Style="{StaticResource NoiseRatingStyle}" />
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Width="29" HeaderTemplate="{StaticResource EditColumnHeaderTemplate}">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Width="17"
                                                Height="17"
                                                Command="{Binding Path=Edit}"
                                                Content="{StaticResource Path_Edit}"
                                                Foreground="{StaticResource ControlTextColor}"
                                                Padding="1"
                                                ToolTip="Edit Track Properties" />
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </GroupBox>
        </Grid>
    </GroupBox>
</UserControl>
